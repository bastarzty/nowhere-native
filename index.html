<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nowhere Native | Cultural Identity in Limbo</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&family=Noto+Serif:ital,wght@0,400;0,700;1,400&family=Space+Mono&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #1a1f35;
            --accent-color: #64b5f6;
            --bg-color: #0a0e1a;
            --text-color: #e0e0e0;
            --card-bg: rgba(255, 255, 255, 0.08);
            --card-border: rgba(255, 255, 255, 0.1);
        }
        
        body {
            font-family: 'Noto Serif', 'Noto Serif SC', serif;
            background-color: var(--bg-color);
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(20, 40, 80, 0.2) 0%, transparent 200px),
                radial-gradient(circle at 70% 60%, rgba(40, 60, 120, 0.2) 0%, transparent 200px);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            line-height: 1.6;
            overflow-x: hidden;
            perspective: 1000px;
        }
        
        /* 星星背景 */
        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: none;
        }
        
        .star {
            position: absolute;
            background-color: white;
            border-radius: 50%;
            opacity: 0;
            animation: twinkle var(--duration) infinite ease-in-out;
            animation-delay: var(--delay);
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 0; transform: scale(0.5); }
            50% { opacity: var(--brightness); transform: scale(1); }
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            position: relative;
            z-index: 1;
        }
        
        header {
            text-align: center;
            padding: 2rem 0;
            margin-bottom: 3rem;
        }
        
        header h1 {
            font-size: 3rem;
            margin: 0;
            letter-spacing: 2px;
            text-shadow: 0 0 10px rgba(100, 181, 246, 0.5);
            color: white;
        }
        
        .subtitle {
            font-style: italic;
            font-size: 1.2rem;
            margin-top: 0.5rem;
            opacity: 0.8;
        }
        
        .input-form {
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }
        
        .input-form h2 {
            text-align: center;
            margin-top: 0;
            color: var(--accent-color);
            letter-spacing: 1px;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
            color: rgba(255, 255, 255, 0.9);
        }
        
        input[type="text"], select {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            background-color: rgba(255, 255, 255, 0.05);
            color: white;
            font-family: inherit;
        }
        
        .input-pair {
            display: flex;
            gap: 1rem;
        }
        
        .input-pair input {
            flex: 1;
        }
        
        .checkbox-group, .radio-group {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 0.5rem;
        }
        
        .checkbox-group label, .radio-group label {
            display: flex;
            align-items: center;
            font-weight: normal;
            margin-bottom: 0;
            cursor: pointer;
        }
        
        input[type="checkbox"], input[type="radio"] {
            margin-right: 0.5rem;
        }
        
        button {
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 0.8rem 1.5rem;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.3s;
            font-family: inherit;
        }
        
        button:hover {
            background-color: #5095db;
        }
        
        .secondary-btn {
            background-color: rgba(100, 181, 246, 0.3);
            color: white;
            border: 1px solid rgba(100, 181, 246, 0.5);
            margin-top: 0.5rem;
            font-size: 0.9rem;
            padding: 0.6rem 1rem;
            width: auto;
        }
        
        .secondary-btn:hover {
            background-color: rgba(100, 181, 246, 0.5);
        }
        
        form button {
            display: block;
            margin: 2rem auto 0;
            width: 200px;
        }
        
        /* 表单分页样式 */
        .form-navigation {
            display: flex;
            justify-content: center;
            margin-bottom: 2rem;
        }
        
        .page-indicator {
            display: flex;
            gap: 8px;
        }
        
        .page {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
        }
        
        .page.active {
            background-color: var(--accent-color);
            color: white;
        }
        
        .form-page {
            display: none;
        }
        
        .form-page.active {
            display: block;
        }
        
        .form-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
        }
        
        .next-btn, .prev-btn {
            background-color: rgba(100, 181, 246, 0.3);
            color: white;
            border: 1px solid rgba(100, 181, 246, 0.5);
        }
        
        .next-btn:hover, .prev-btn:hover {
            background-color: rgba(100, 181, 246, 0.5);
        }
        
        .field-description {
            font-size: 0.9rem;
            margin: 0.3rem 0;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .field-example {
            font-size: 0.8rem;
            margin: 0.2rem 0 0.5rem;
            color: rgba(255, 255, 255, 0.5);
            font-style: italic;
        }
        
        textarea {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            background-color: rgba(255, 255, 255, 0.05);
            color: white;
            font-family: inherit;
            min-height: 100px;
            resize: vertical;
        }
        
        .monologue-container {
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 2rem;
            display: none;
            flex-direction: column;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }
        
        .output-text {
            font-size: 1.1rem;
            line-height: 1.8;
            white-space: pre-line;
            margin-bottom: 2rem;
            color: rgba(255, 255, 255, 0.9);
        }
        
        .actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .hidden {
            display: none;
        }
        
        footer {
            text-align: center;
            margin-top: 3rem;
            padding: 1rem;
            color: rgba(255, 255, 255, 0.6);
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .input-pair {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .checkbox-group, .radio-group {
                flex-direction: column;
                gap: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="stars" id="stars"></div>
    <div class="container">
        <header>
            <h1>Nowhere Native</h1>
            <p class="subtitle">A generative experience for the culturally displaced.</p>
        </header>

        <section class="input-form">
            <h2>Create Your Cultural Identity Monologue</h2>
            <div class="form-navigation">
                <div class="page-indicator">
                    <span class="page active" data-page="1">1</span>
                    <span class="page" data-page="2">2</span>
                </div>
            </div>
            
            <form id="identity-form">
                <!-- Page 1 -->
                <div class="form-page active" id="form-page-1">
                    <div class="form-group">
                        <label for="name">Your Names (In Different Languages)</label>
                        <div class="input-pair">
                            <input type="text" id="name-local" placeholder="Name in your native language" required>
                            <input type="text" id="name-foreign" placeholder="Your adopted name" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Languages You Speak (Select all that apply)</label>
                        <div class="checkbox-group">
                            <label><input type="checkbox" name="language" value="chinese"> Chinese</label>
                            <label><input type="checkbox" name="language" value="english"> English</label>
                            <label><input type="checkbox" name="language" value="korean"> Korean</label>
                            <label><input type="checkbox" name="language" value="japanese"> Japanese</label>
                            <label><input type="checkbox" name="language" value="french"> French</label>
                            <label><input type="checkbox" name="language" value="spanish"> Spanish</label>
                            <label><input type="checkbox" name="language" value="arabic"> Arabic</label>
                            <label><input type="checkbox" name="language" value="hindi"> Hindi</label>
                            <label><input type="checkbox" name="language" value="other"> Other</label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="native-language">Your Primary Language</label>
                        <select id="native-language" required>
                            <option value="">-- Select Primary Language --</option>
                            <option value="chinese">Chinese</option>
                            <option value="english">English</option>
                            <option value="korean">Korean</option>
                            <option value="japanese">Japanese</option>
                            <option value="french">French</option>
                            <option value="spanish">Spanish</option>
                            <option value="arabic">Arabic</option>
                            <option value="hindi">Hindi</option>
                            <option value="other">Other</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Cultural Background (Select all that apply)</label>
                        <div class="checkbox-group">
                            <label><input type="checkbox" name="cultural-bg" value="east-asia"> East Asian</label>
                            <label><input type="checkbox" name="cultural-bg" value="western"> Western</label>
                            <label><input type="checkbox" name="cultural-bg" value="southeast-asia"> Southeast Asian</label>
                            <label><input type="checkbox" name="cultural-bg" value="south-asia"> South Asian</label>
                            <label><input type="checkbox" name="cultural-bg" value="middle-east"> Middle Eastern</label>
                            <label><input type="checkbox" name="cultural-bg" value="africa"> African</label>
                            <label><input type="checkbox" name="cultural-bg" value="latin-america"> Latin American</label>
                        </div>
                    </div>
                    
                    <button type="button" id="next-page-btn" class="next-btn">Next Page</button>
                </div>
                
                <!-- Page 2 -->
                <div class="form-page" id="form-page-2">
                    <div class="form-group">
                        <label for="food">Flavors of Home</label>
                        <p class="field-description">Describe a meal, dish, or flavor that strongly connects you to home or childhood memory.</p>
                        <p class="field-example">Example: "My mother's homemade kimchi stew."</p>
                        <input type="text" id="food" placeholder="Share a taste of home..." required>
                    </div>
                    
                    <div class="form-group">
                        <label for="soundtrack">Soundtrack of You</label>
                        <p class="field-description">Share a song, sound, or type of music that deeply resonates with your identity or sense of belonging.</p>
                        <input type="text" id="soundtrack" placeholder="Share a song that represents you...">
                    </div>
                    
                    <div class="form-group">
                        <label for="home-place">Place You Call Home</label>
                        <p class="field-description">Describe a specific place or multiple places where you feel deeply connected or feel a strong sense of belonging.</p>
                        <p class="field-example">Example: "The balcony of my childhood apartment in Seoul."</p>
                        <input type="text" id="home-place" placeholder="Describe a place you call home...">
                    </div>
                    
                    <div class="form-group">
                        <label for="object">An Object of Significance</label>
                        <p class="field-description">Share an object or personal item that symbolizes your identity or journey.</p>
                        <p class="field-example">Example: "My worn-out passport filled with stamps."</p>
                        <input type="text" id="object" placeholder="Describe an object meaningful to you...">
                    </div>
                    
                    <div class="form-group">
                        <label for="aspiration">Dreams and Aspirations</label>
                        <p class="field-description">Briefly describe a dream, goal, or aspiration shaped by your cultural background or personal journey.</p>
                        <p class="field-example">Example: "To open a café that blends flavors from both my cultures."</p>
                        <input type="text" id="aspiration" placeholder="Share your dream...">
                    </div>
                    
                    <div class="form-group">
                        <label for="belonging">Experiences of Belonging or Alienation</label>
                        <p class="field-description">Optional: Share a brief memory or experience of feeling deeply connected or profoundly disconnected from your cultural identity.</p>
                        <textarea id="belonging" placeholder="Share your experience..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>How Do You Feel About Your Cultural Identity?</label>
                        <div class="radio-group">
                            <label><input type="radio" name="feeling" value="lost" checked> Lost</label>
                            <label><input type="radio" name="feeling" value="proud"> Proud</label>
                            <label><input type="radio" name="feeling" value="conflicted"> Conflicted</label>
                            <label><input type="radio" name="feeling" value="nostalgic"> Nostalgic</label>
                            <label><input type="radio" name="feeling" value="alienated"> Alienated</label>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" id="prev-page-btn" class="prev-btn">Previous Page</button>
                        <button type="submit">Generate Monologue</button>
                    </div>
                </div>
            </form>
        </section>

        <section class="monologue-container" id="monologue-output">
            <div class="output-text"></div>
            <div class="actions hidden">
                <button id="regenerate-btn">Regenerate</button>
                <div id="language-selector-container">
                    <span class="language-label">Language | Language:</span>
                </div>
                <button id="save-btn">Save as Image</button>
                <button id="upload-btn">Upload to Collection</button>
            </div>
        </section>

        <footer>
            <p>Nowhere Native - Exploring Identity Displacement</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 创建星星背景
            const starsContainer = document.getElementById('stars');
            const starCount = 200;
            
            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                
                // 随机大小和位置
                const size = Math.random() * 2 + 1;
                const left = Math.random() * 100;
                const top = Math.random() * 100;
                
                // 随机动画参数
                const duration = Math.random() * 5 + 3;
                const delay = Math.random() * 5;
                const brightness = Math.random() * 0.7 + 0.3;
                
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                star.style.left = `${left}%`;
                star.style.top = `${top}%`;
                star.style.setProperty('--duration', `${duration}s`);
                star.style.setProperty('--delay', `${delay}s`);
                star.style.setProperty('--brightness', brightness);
                
                starsContainer.appendChild(star);
            }
            
            // 表单分页控制
            const nextPageBtn = document.getElementById('next-page-btn');
            const prevPageBtn = document.getElementById('prev-page-btn');
            const page1 = document.getElementById('form-page-1');
            const page2 = document.getElementById('form-page-2');
            const pageIndicators = document.querySelectorAll('.page');
            
            // 切换到下一页
            nextPageBtn.addEventListener('click', function() {
                // 检查第一页的必填字段
                const nameLocal = document.getElementById('name-local').value;
                const nameForeign = document.getElementById('name-foreign').value;
                const nativeLanguage = document.getElementById('native-language').value;
                
                if (!nameLocal || !nameForeign || !nativeLanguage) {
                    alert('Please fill in all required fields before continuing');
                    return;
                }
                
                page1.classList.remove('active');
                page2.classList.add('active');
                pageIndicators[0].classList.remove('active');
                pageIndicators[1].classList.add('active');
            });
            
            // 切换到上一页
            prevPageBtn.addEventListener('click', function() {
                page2.classList.remove('active');
                page1.classList.add('active');
                pageIndicators[1].classList.remove('active');
                pageIndicators[0].classList.add('active');
            });
            
            // 点击页面指示器
            pageIndicators.forEach(indicator => {
                indicator.addEventListener('click', function() {
                    const targetPage = this.getAttribute('data-page');
                    
                    if (targetPage === '1') {
                        page2.classList.remove('active');
                        page1.classList.add('active');
                        pageIndicators[1].classList.remove('active');
                        pageIndicators[0].classList.add('active');
                    } else if (targetPage === '2') {
                        // 检查第一页的必填字段
                        const nameLocal = document.getElementById('name-local').value;
                        const nameForeign = document.getElementById('name-foreign').value;
                        const nativeLanguage = document.getElementById('native-language').value;
                        
                        if (!nameLocal || !nameForeign || !nativeLanguage) {
                            alert('Please fill in all required fields before continuing');
                            return;
                        }
                        
                        page1.classList.remove('active');
                        page2.classList.add('active');
                        pageIndicators[0].classList.remove('active');
                        pageIndicators[1].classList.add('active');
                    }
                });
            });
            
            // 简单测试文本显示
            const form = document.getElementById('identity-form');
            const outputContainer = document.getElementById('monologue-output');
            const outputText = outputContainer.querySelector('.output-text');
            let currentText = '';
            let currentMonologue = {}; // 存储当前独白的数据
            
            // 中文版句子模板
            const chineseSentenceTemplates = {
                names: [
                    "在学校他们叫我\"{nameForeign}\"，但我的心回应的是\"{nameLocal}\"。",
                    "我的身份证上写着\"{nameForeign}\"，但我的祖母仍然叫我\"{nameLocal}\"。",
                    "有些日子我介绍自己为\"{nameForeign}\"，其他日子我是\"{nameLocal}\"。",
                    "我已经练习写\"{nameForeign}\"太多次，有时候我忘记怎么写\"{nameLocal}\"。",
                    "在他们的世界里我是\"{nameForeign}\"，在我的世界里我是\"{nameLocal}\"。"
                ],
                
                food: [
                    "我已经忘记如何用母语书写我的名字，但我记得每个周末{food}的味道。",
                    "{food}的香味把我带回到一个我几乎不记得的地方。",
                    "我梦见{food}——一种我无法完全向新朋友描述的家乡味道。",
                    "我母亲的{food}食谱，当我自己做时永远不会有同样的味道。",
                    "我发现自己在异国餐厅吃{food}时流泪，对自己的反应感到惊讶。"
                ],
                
                identity: [
                    "我属于一个从未真正了解我的城市，和一个忘记如何解释我变成什么样的家庭。",
                    "我的口音随着交谈对象而变化——一只为了生存而适应的变色龙。",
                    "家是一个我已经重新定义太多次的概念。",
                    "我像人类学家一样研究自己的文化传统，试图理解自己的遗产。",
                    "我学习的语言越多，我发现自己的版本就越多。"
                ],
                
                language: [
                    "有些夜晚我用英语做梦，用我的母语哭泣。",
                    "说话前我会翻译自己的想法，一个没人看见的秘密过程。",
                    "有些感受我只能用母语表达。",
                    "无论离开多久，我仍用第一语言计数和祈祷。",
                    "我用灵魂的不同部分说不同的语言。"
                ],
                
                floating: [
                    "我像一座漂流在两个世界之间的孤岛。",
                    "我存在于文化之间的空间中，从未完全属于任何地方。",
                    "我的身份是我去过的地方不断变化的马赛克。",
                    "我像幽灵一样在世界之间导航——存在但永远不完全可见。",
                    "我在文化身份之间的连字符中建立了自己的家。"
                ],
                
                ending: [
                    "我是谁？\n你告诉我。",
                    "我属于哪里？\n或许无处亦处处。",
                    "拥有根基意味着什么？\n我仍在学习。",
                    "我是来自这里还是那里？\n答案随着月亮变化。",
                    "我何时才能有家的感觉？\n也许是当我停止问这个问题的时候。"
                ],
                
                place: [
                    "我记得{place} - 不是作为一个地点，而是作为我随身携带的一种感觉。",
                    "有时我闭上眼睛想象自己回到{place}，那里一切都有意义。",
                    "{place}现在只存在于我的记忆中，一个我可以参观但永远不能停留的地方。",
                    "我与{place}之间的距离随着岁月流逝而变得越来越宽。",
                    "我在我生活过的每个地方都重新创造了{place}的一些角落。"
                ],
                
                object: [
                    "我的{object}跨越边境与我同行，默默见证了我的转变。",
                    "我把{object}放在身边，是我曾经的自己的有形提醒。",
                    "{object}将我连接到一个有时感觉像别人生活的过去。",
                    "当我需要记住我来自哪里时，我会触摸我的{object}。",
                    "我的{object}承载着我无法完全翻译的故事。"
                ],
                
                soundtrack: [
                    "{soundtrack}的旋律像影子一样跟随着我，连接着我分散的自我碎片。",
                    "当思乡之情变得难以忍受时，我会播放{soundtrack}。",
                    "在{soundtrack}的音符中，我发现了我留下的自我的回声。",
                    "{soundtrack}弥合了我过去和现在之间的鸿沟。",
                    "{soundtrack}的节奏与一颗被困在世界之间的心同步跳动。"
                ],
                
                dreams: [
                    "我{dream}的梦想源于我分裂身份的碰撞。",
                    "我想知道实现{dream}是否最终会让我感到完整。",
                    "通往{dream}的道路因多种文化的期望而变得复杂。",
                    "我的祖先不会理解我{dream}的愿望，这既解放又可怕。",
                    "我追求{dream}作为调和我内心不同世界的方式。"
                ],
                
                // GPT生成的句子（中文版）
                languageDisplacement: [
                    "我忘记了如何用母语写我的名字，但我记得当有人念错我名字时的感受。",
                    "我的口音有时区。",
                    "当我用普通话思考时，我很响亮。用英语时，我很谨慎。无论哪种，我都不完全是我自己。",
                    "我的梦仍说着我清醒时不再使用的语言。",
                    "我的舌头在转换语言时会结巴。"
                ],
                
                systemicResistance: [
                    "我的身份处于测试版。每天更新。随时可能改变。",
                    "每份表格都要求我填写法定姓名。但我从不知道该给哪一个。",
                    "我没有选择我的英文名。它是为了帮助我'融入'而挑选的。",
                    "签证队伍教会了我哪本护照更重要。"
                ],
                
                familialTerms: [
                    "英语中没有与奶奶对我的称呼相对应的词。",
                    "学校里叫我Hana，但姑姑叫我阿娜。我不记得我用哪个名字哭泣。",
                    "我有三个名字，每个名字都属于不同版本的我。",
                    "我父母叫我一个名字，朋友叫我另一个。我对两者都有回应。"
                ],
                
                rootlessness: [
                    "当我停止翻译，我就停止存在。",
                    "家的味道是大蒜和芝麻油。但这里，味道是洗衣粉和冷空气。",
                    "我来自太多地方，无法只属于一处。",
                    "我思念一个我不确定是否存在过的地方。"
                ],
                
                digitalExistence: [
                    "我的母语在电脑上被红色波浪线标记为错误。",
                    "我的名字被自动更正为更容易让你读的版本。",
                    "在每个数据库里，我的名字都是拼写错误。"
                ]
            };
            
            // 随机选择一个数组中的元素
            function getRandomElement(array) {
                return array[Math.floor(Math.random() * array.length)];
            }
            
            // 创建语言选择器
            const languageSelector = document.createElement('select');
            languageSelector.id = 'output-language';
            languageSelector.innerHTML = `
                <option value="original">Original</option>
                <option value="chinese">Chinese</option>
            `;
            
            // 添加到DOM
            const selectorContainer = document.getElementById('language-selector-container');
            selectorContainer.appendChild(languageSelector);
            
            // 添加语言切换功能
            languageSelector.addEventListener('change', function() {
                if (currentText && this.value === 'chinese') {
                    // 获取基本数据
                    const nameLocal = document.getElementById('name-local').value;
                    const nameForeign = document.getElementById('name-foreign').value;
                    const food = document.getElementById('food').value;
                    const place = document.getElementById('home-place').value;
                    const object = document.getElementById('object').value;
                    const soundtrack = document.getElementById('soundtrack').value;
                    const dream = document.getElementById('aspiration').value;
                    
                    // 生成随机中文独白
                    let chineseText = '';
                    
                    // 添加随机的主要身份句子
                    if (Math.random() < 0.5) {
                        // 使用新的GPT生成的句子
                        const categories = ['languageDisplacement', 'systemicResistance', 'familialTerms', 'rootlessness', 'digitalExistence'];
                        const randomCategory = categories[Math.floor(Math.random() * categories.length)];
                        chineseText += getRandomElement(chineseSentenceTemplates[randomCategory]) + '\n\n';
                    }
                    
                    // 名字部分
                    chineseText += getRandomElement(chineseSentenceTemplates.names)
                        .replace('{nameLocal}', nameLocal)
                        .replace('{nameForeign}', nameForeign) + '\n\n';
                    
                    // 食物部分
                    chineseText += getRandomElement(chineseSentenceTemplates.food)
                        .replace('{food}', food) + '\n\n';
                    
                    // 添加地点部分（如果有）
                    if (place) {
                        chineseText += getRandomElement(chineseSentenceTemplates.place)
                            .replace('{place}', place) + '\n\n';
                    }
                    
                    // 添加物品部分（如果有）
                    if (object) {
                        chineseText += getRandomElement(chineseSentenceTemplates.object)
                            .replace('{object}', object) + '\n\n';
                    }
                    
                    // 添加音乐部分（如果有）
                    if (soundtrack) {
                        chineseText += getRandomElement(chineseSentenceTemplates.soundtrack)
                            .replace('{soundtrack}', soundtrack) + '\n\n';
                    }
                    
                    // 添加梦想部分（如果有）
                    if (dream) {
                        chineseText += getRandomElement(chineseSentenceTemplates.dreams)
                            .replace('{dream}', dream) + '\n\n';
                    }
                    
                    // 添加额外的随机GPT生成的句子
                    if (Math.random() < 0.7) {
                        const categories = ['languageDisplacement', 'systemicResistance', 'familialTerms', 'rootlessness', 'digitalExistence'];
                        const randomCategory = categories[Math.floor(Math.random() * categories.length)];
                        chineseText += getRandomElement(chineseSentenceTemplates[randomCategory]) + '\n\n';
                    }
                    
                    // 添加身份认同部分
                    chineseText += getRandomElement(chineseSentenceTemplates.identity) + '\n\n';
                    chineseText += getRandomElement(chineseSentenceTemplates.language) + '\n\n';
                    chineseText += getRandomElement(chineseSentenceTemplates.floating) + '\n\n';
                    chineseText += getRandomElement(chineseSentenceTemplates.ending);
                    
                    outputText.innerHTML = chineseText;
                } else {
                    // 恢复原文
                    outputText.innerHTML = currentText;
                }
            });
            
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // 收集所有数据
                const nameLocal = document.getElementById('name-local').value;
                const nameForeign = document.getElementById('name-foreign').value;
                const food = document.getElementById('food').value;
                const place = document.getElementById('home-place').value;
                const object = document.getElementById('object').value;
                const soundtrack = document.getElementById('soundtrack').value;
                const dream = document.getElementById('aspiration').value;
                const belonging = document.getElementById('belonging').value;
                
                // 获取选中的文化背景
                const culturalBg = Array.from(document.querySelectorAll('input[name="cultural-bg"]:checked'))
                    .map(checkbox => checkbox.value);
                
                // 获取选中的语言
                const languages = Array.from(document.querySelectorAll('input[name="language"]:checked'))
                    .map(checkbox => checkbox.value);
                
                // 获取选中的感受
                const feeling = document.querySelector('input[name="feeling"]:checked').value;
                
                // 保存当前独白数据用于上传
                currentMonologue = {
                    nameLocal,
                    nameForeign,
                    food,
                    place,
                    object,
                    soundtrack,
                    dream,
                    belonging,
                    culturalBg,
                    languages,
                    feeling,
                    text: '',
                    timestamp: new Date().toISOString()
                };
                
                // 生成随机独白
                let generatedText = '';
                
                // 添加随机的主要身份句子
                if (Math.random() < 0.5) {
                    // 使用新的GPT生成的句子
                    const categories = ['languageDisplacement', 'systemicResistance', 'familialTerms', 'rootlessness', 'digitalExistence'];
                    const randomCategory = categories[Math.floor(Math.random() * categories.length)];
                    generatedText += getRandomElement(sentenceTemplates[randomCategory]) + '\n\n';
                }
                
                // 名字部分
                generatedText += getRandomElement(sentenceTemplates.names)
                    .replace('{nameLocal}', nameLocal)
                    .replace('{nameForeign}', nameForeign) + '\n\n';
                
                // 食物部分
                generatedText += getRandomElement(sentenceTemplates.food)
                    .replace('{food}', food) + '\n\n';
                
                // 添加地点部分（如果有）
                if (place) {
                    generatedText += getRandomElement(sentenceTemplates.place)
                        .replace('{place}', place) + '\n\n';
                }
                
                // 添加物品部分（如果有）
                if (object) {
                    generatedText += getRandomElement(sentenceTemplates.object)
                        .replace('{object}', object) + '\n\n';
                }
                
                // 添加音乐部分（如果有）
                if (soundtrack) {
                    generatedText += getRandomElement(sentenceTemplates.soundtrack)
                        .replace('{soundtrack}', soundtrack) + '\n\n';
                }
                
                // 添加梦想部分（如果有）
                if (dream) {
                    generatedText += getRandomElement(sentenceTemplates.dreams)
                        .replace('{dream}', dream) + '\n\n';
                }
                
                // 添加额外的随机GPT生成的句子
                if (Math.random() < 0.7) {
                    const categories = ['languageDisplacement', 'systemicResistance', 'familialTerms', 'rootlessness', 'digitalExistence'];
                    const randomCategory = categories[Math.floor(Math.random() * categories.length)];
                    generatedText += getRandomElement(sentenceTemplates[randomCategory]) + '\n\n';
                }
                
                // 添加身份认同部分
                generatedText += getRandomElement(sentenceTemplates.identity) + '\n\n';
                generatedText += getRandomElement(sentenceTemplates.language) + '\n\n';
                generatedText += getRandomElement(sentenceTemplates.floating) + '\n\n';
                generatedText += getRandomElement(sentenceTemplates.ending);
                
                currentText = generatedText;
                currentMonologue.text = currentText;
                
                // 显示结果
                outputContainer.style.display = 'flex';
                outputContainer.querySelector('.actions').classList.remove('hidden');
                outputText.innerHTML = currentText;
                
                // 重置语言选择器
                languageSelector.value = 'original';
            });
            
            // 保存图片功能
            document.getElementById('save-btn').addEventListener('click', function() {
                alert('下载功能将在未来版本中提供');
            });
            
            // 上传到记忆收集器功能
            document.getElementById('upload-btn').addEventListener('click', function() {
                // 上传当前独白到服务器或本地存储
                if(!currentMonologue.text) {
                    alert('Please generate a monologue first');
                    return;
                }
                
                // 暂时使用localStorage存储数据
                let memories = JSON.parse(localStorage.getItem('nowhere-native-memories') || '[]');
                memories.push(currentMonologue);
                localStorage.setItem('nowhere-native-memories', JSON.stringify(memories));
                
                alert('Your monologue has been collected. Check all collected monologues in the "Memory Box".');
                
                // 打开展示页面
                window.open('memories.html', '_blank');
            });
            
            // 重新生成功能
            document.getElementById('regenerate-btn').addEventListener('click', function() {
                form.dispatchEvent(new Event('submit'));
            });
        });
    </script>
</body>
</html> 